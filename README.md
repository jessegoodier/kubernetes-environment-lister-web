# kubernetes-web-environment-lister

Simple tool to find all the namespaces with ingresses and list the pods/containers/images.

Why was this made?

1. Easy to use: No need to type commands, just find the environment you need through a simple interface.
2. Read-only cluster-wide visibility.
3. Limited local namespace rights: to restart the web-server deployment.

TODO:

1. refactor to output json
2. Watch ingresses and helm resources instead of a cronJob?
3. Multi-cluster (with mongodb?)
4. Search
5. self-update option
6. recommend fixes for non-running pods (using AI?)
7. get all pods, not just those in namespaces with ingresses, add option to filter in UI

Alternatives to consider:

1. <https://headlamp.dev/docs/latest/installation/>
2. <https://k9scli.io/topics/install/>

Shout out to all the AI tools for writing a majority of this. The CSS was generated by copilot with the request for dark mode in the style of Kubecost.

Sample output:

<https://htmlpreview.github.io/?https://github.com/jessegoodier/kubernetes-environment-lister-web/blob/main/docs/index.html>

Screenshot:
![sample-output](screenshot.png)

## Security Considerations

This will expose every ingress in your cluster.  Please consider the security implications of this.

See the [oauth2 readme](auth/oauth2-proxy/README.md) as an example of how to secure this.

The service is exposed by an unprivileged (no service account and non-root) nginx web server.

The cronJob that creates the html configMap has a serviceAccount with cluster-wide privileges to read the required resources and `reload restart` the nginx deployment.

If you remove the helm list function, RBAC get secrets is not needed.

## Usage

Clone this repo:

```sh
git clone git@github.com:jessegoodier/kubernetes-environment-lister-web.git
```

Edit the manifests to fit your needs.
Then:

```sh
kubectl create ns environment-lister
kubectl create cm get-environments -n environment-lister --from-file get_environments.py
kubectl apply -f ./manifests -n environment-lister
```

Expose the website:

```sh
kubectl port-forward -n environment-lister svc/environment-lister 8080
```

You'll likely want to expose the service with a protected ingress. An example of that is provided in [oauth2 readme](auth/oauth2-proxy/README.md).

* Note that the nginx-web will have a status of `ContainerCreating` until the cronjob runs and creates the html configMap. This job runs every 13 minutes and can be configured in the [cronjob manifest](manifests/kubernetes-cronjob.yaml).

### One-off run/testing

A pod manifest is included for one-off runs of the python script. This is useful for debugging or if you don't want to wait for the cronjob to run.

```sh
kubectl create cm get-environments -n environment-lister --from-file get_environments.py
kubectl apply -f ./manifests/rbac.yaml -n environment-lister
kubectl apply -f ./testing-pod.yaml -n environment-lister
```

### Dockerfile

The html is written by a markdown conversion utility called [markdown2](https://github.com/trentm/python-markdown2).

The logic was that markdown was easier to write (and read) in the python script.

The parent Dockerfile is maintained here: <https://github.com/alpine-docker/k8s>

The Dockerfile can be build for multi-architecture using a command similar to:

```sh
docker buildx build --platform=linux/amd64,linux/arm64 -t jgoodier/markdown2-kubectl --push .
```

The most recent build that I pushed is here: <https://hub.docker.com/r/jgoodier/markdown2-kubectl/tags>
